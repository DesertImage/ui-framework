using System.Collections;using System.Collections.Generic;using System.Linq;using DesertImage.ECS;using DesertImage.Extensions;using UnityEngine;namespace DesertImage{    [CreateAssetMenu(fileName = "ObjectsLibrary", menuName = "Factories/ObjectsLibrary")]    public class ScriptableObjectsLibrary : ScriptableObject, IAwake, IObjectsLibrary    {        private const int MaxObjPerFrame = 5;        public List<ObjectsSpawnNode> Nodes;        public void OnAwake()        {            var factorySpawn = Core.Instance.Get<FactorySpawn>();            if (factorySpawn == null) return;            var registeredCount = 0;            for (var i = 0; i < Nodes.Count; i++)            {                var spawnNode = Nodes[i];                if (!spawnNode.Prefab) continue;                registeredCount++;                if (registeredCount >= MaxObjPerFrame)                {                    registeredCount = 0;                }                factorySpawn.Register(spawnNode);            }        }        private IEnumerator RegisterProcess()        {            var factorySpawn = Core.Instance.Get<FactorySpawn>();            if (factorySpawn == null) yield break;            var registeredCount = 0;            for (var i = 0; i < Nodes.Count; i++)            {                var spawnNode = Nodes[i];                if (!spawnNode.Prefab) continue;                registeredCount++;                if (registeredCount >= MaxObjPerFrame)                {                    registeredCount = 0;                    if (40f.IsSuccessProbability())                    {                        yield return null;                    }                }                factorySpawn.Register(spawnNode);            }        }        public void Register(ObjectsSpawnNode node)        {            var existingNode = Nodes.FirstOrDefault(x => x.Id == node.Id);            if (existingNode != default)            {#if DEBUG                UnityEngine.Debug.LogError("[FactorySpawn] already contains node with id " + node.Id);#endif                return;            }            Nodes.Add(node);        }    }}